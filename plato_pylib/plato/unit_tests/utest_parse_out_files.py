#!/usr/bin/python3


import os
import unittest

import plato_pylib.plato.parse_plato_out_files as tCode

class testExtractEnergiesFromOutFile(unittest.TestCase):
	def setUp(self):
		self.filePathDict = dict()
		self.filePathDict["tb1fileA"], unusedStr = createTb1OutFilePartialA()
		self.filePathDict["tb2fileA"], unusedStr = createTb2OutFilePartialA()
	def tearDown(self):
		[os.remove(x) for x in self.filePathDict.values()]

	def testTotalElectronicEnergy_tb1(self):
		''' Test the electronic energy from tb1 is parsed correctly; not this is a cohesive energy measure '''
		testInpFile = self.filePathDict["tb1fileA"]
		expectedElectronic = 1.0089780 + -1.8915282
		actualElectronic = tCode.parsePlatoOutFile(testInpFile)["energies"].getElectronicE()
		self.assertAlmostEqual(expectedElectronic,actualElectronic)

	def testCohesiveElectronicEnergy_tb2(self):
		testInpFile = self.filePathDict["tb2fileA"]
		expectedCohesive = -0.03136604
		actualCohesive = tCode.parsePlatoOutFile(testInpFile)["energies"].getElectronicE()
		self.assertAlmostEqual(expectedCohesive, actualCohesive)

	def testGetErepFromTb2(self):
		testInpFile = self.filePathDict["tb2fileA"]
		fakeEBand = -0.02
		expectedERep = -0.011366
		actualERep = tCode.parsePlatoOutFile(testInpFile)["energies"].getERepFromEBand(fakeEBand)
		self.assertAlmostEqual(expectedERep, actualERep)

class testExtractLatticeFromOutFile(unittest.TestCase):
	def setUp(self):
		self.filePathDict = dict()
		self.filePathDict["tb1FileOptA"], unusedStr = createTb1OutFilePartialB_lattparamsOpt()
		self.filePathDict["tb2FileCellA"], unusedStr = createTb2OutFilePartialB_lattparams()
	def tearDown(self):
		[os.remove(x) for x in self.filePathDict.values()]

	def testLattParamsAngles_opt(self):
		''' Test tCode.parsePlatoOutFile produces expected lattice parameters/angles for
		    an optimisation (tb1) '''
		testInpFile = self.filePathDict["tb1FileOptA"]
		expectedLattParams = [7.45026, 7.45025616801194, 12.09628]

		expectedLattAngles = [90.0, 90.0, 120.0]
		expectedVolume = 581.466851 #Comes from plato output file
		allFileInfo = tCode.parsePlatoOutFile(testInpFile)

		actualLattParams = allFileInfo["unitCell"].getLattParamsList()
		actualLattAngles = allFileInfo["unitCell"].getLattAnglesList()
		actualVolume = allFileInfo["unitCell"].getVolume()
		[self.assertAlmostEqual(x,y, places=4) for x,y in zip(expectedLattParams, actualLattParams)]
		[self.assertAlmostEqual(x,y, places=4) for x,y in zip(expectedLattAngles, actualLattAngles)]
		self.assertAlmostEqual(expectedVolume, actualVolume, places=3)

	def testLattParamsAngles_tb2(self):
		''' Test tCode.parsePlatoOutFile gets correct lattice params/angles from tb2 '''
		testInpFile = self.filePathDict["tb2FileCellA"]
		expectedLattParams = [6.064889, 6.064889, 9.846989]
		expectedLattAngles = [90.0,90.0,120.0]
		allFileInfo = tCode.parsePlatoOutFile(testInpFile)

		actualLattParams = allFileInfo["unitCell"].getLattParamsList()
		actualLattAngles = allFileInfo["unitCell"].getLattAnglesList()
		[self.assertAlmostEqual(x,y, places=4) for x,y in zip(expectedLattParams, actualLattParams)]
		[self.assertAlmostEqual(x,y, places=4) for x,y in zip(expectedLattAngles, actualLattAngles)]


class testParseDftFile(unittest.TestCase):

	def setUp(self):
		self.filePaths = dict()
		self.filePaths["dftA"] = createDftOutFileA()

	def tearDown(self):
		pass

	def testParseEnergy(self):
		expectedEnergy = -1.7340183
		actualEnergy = tCode.parsePlatoOutFile(self.filePaths["dftA"])["energies"].getElectronicE()
		self.assertAlmostEqual(expectedEnergy, actualEnergy)

	def testParseNumbAtoms(self):
		expectedNumbAtoms = 1
		actualNumbAtoms = tCode.parsePlatoOutFile(self.filePaths["dftA"])["numbAtoms"]
		self.assertEqual(expectedNumbAtoms, actualNumbAtoms)

class testEnergyValsClass(unittest.TestCase):
	def testTotalElectronicTb1(self):
		testObj = tCode.EnergyVals(e0=2.9,e1=1.1)
		expectedElectronic = 4.0
		actualElectronic = testObj.getElectronicE()	
		self.assertAlmostEqual(expectedElectronic, actualElectronic)





def createTb1OutFilePartialA():
	filePath = os.path.join( os.getcwd(), "tb1outPartialA.out")
	fileStr ="Model characteristics\n---------------------\nTabulated tight binding\nOverlap      : 0\nCrystal field: 0\nThree centre : 0\nN_{ij} Integrals : 0\nSN Integrals: 0\nSelf-consistency parameters:\n----------------------------\nNumber of loops         = 30\nEnergy tolerance        = 0.000000\nDensity tolerance       = 0.001000\nMixing scheme           = 1\nPreconditioning type    = 1\nThomas-Fermi K          = 1.000000\nMix factor              = 0.200000\nNumber of mixing levels = 5\n\nOther parameters:\n-----------------\nExcess number of electrons = 0.000000\n\nAfter relaxation:\n=================\n\nPrimitive translation vectors (a0):\n-----------------------------------\n     5.13147      5.13147      0.00000\n     5.13147      0.00000      5.13147\n     0.00000      5.13147      5.13147\nVolume       = 270.244193 a0^3\nCell repeats =    4    3    3\n\nNumber of atoms = 2\nNeighbor cutoff =      7.00000 a0\n\nAtomic positions (a0):\n----------------------\nSi     10.25745     10.25745     10.25745\nSi      2.57124      2.57124      2.57124\n\nTotal forces (Ry/a0):\n---------------------\n -1.417724538e-05  -1.417724538e-05  -1.417724538e-05\n  1.417724538e-05   1.417724538e-05   1.417724538e-05\n\nStress Tensor (MBars):\n----------------------\n   0.004974960316    0.009437011637    0.009437011637\n   0.009437011637    0.004974960316    0.009437011637\n   0.009437011637    0.009437011637    0.004974960316\n\nEFermi =     -0.4109111 Ry\n(kT    =      0.0010000 Ry)\n\nE0               =      1.0089780 Ry\nE1               =     -1.8915282 Ry\nEntropy          =      0.0000000 Ry\n------------------------------------\nTotal (Free)     =     -0.8825502 Ry\n                 =    -12.0078015 eV\n                 =   -277.6061662 kCal/mol\n                 =  -1161.4360667 kJ/mol\n------------------------------------\nTotal (Internal) =     -0.8825502 Ry\n                 =    -12.0078015 eV\n                 =   -277.6061662 kCal/mol\n                 =  -1161.4360667 kJ/mol\n------------------------------------\nTotal (kT->0)    =     -0.8825502 Ry\n                 =    -12.0078015 eV\n                 =   -277.6061662 kCal/mol\n                 =  -1161.4360667 kJ/mol\n\nNet atomic charges (Mulliken):\n------------------------------\nSi(   1) =     -0.00000\nSi(   2) =     -0.00000\n\nOrbital populations (Mulliken):\n-------------------------------\nSi(   1):  1.47  0.84  0.84  0.84 \nSi(   2):  1.47  0.84  0.84  0.84 \n\nTotal multipole moments:\n------------------------\n\nN.B. See the manual for the ordering of the moments.\n\nDipole  [e*a0]:  -0.00000000  -0.00000000  -0.00000000\nDipole [Debye]:  -0.00000000  -0.00000000  -0.00000000\n\nQuadrupole  [e*a0^2]:  -0.00000000  -0.00000000  -0.00000000  -0.00000000  -0.00000000  -0.00000000\nQuadrupole [Debye*A]:  -0.00000000  -0.00000000  -0.00000000  -0.00000000  -0.00000000  -0.00000000\n\n"
	with open(filePath, "wt") as f:
		f.write(fileStr)
	return filePath, fileStr

def createTb2OutFilePartialA():
	filePath = os.path.join( os.getcwd(), "tb2outPartialA.out" )
	fileStr = "Cell vectors in Bohr radii\n==========================\na1 = (      3.372899,       3.372899,      -3.372899)\na2 = (     -3.372899,       3.372899,       3.372899)\na3 = (      3.372899,      -3.372899,       3.372899)\n\nb1 = (      0.931422,       0.931422,              0)\nb2 = (             0,       0.931422,       0.931422)\nb3 = (      0.931422,              0,       0.931422)\n\nGeometry (xyz format in Angstroms)\n==================================\n1\n\nMg              0              0              0\n\nExchange and correlation functional\n===================================\nPBE\n\nIntegral mesh\n=============\nType: regular mesh\ndx  : 0.180000\n\nElectron chemical potential (Ry)\n================================\nMu =     -0.1279633\n\nEnergy\n======\nBreakdown of zeroth order energy:\nKinetic energy           =      0.7101726 Ry\nNeutral atom energy      =     -0.9010047 Ry\nElectrostatic energy     =      -1.231837 Ry\nNon-local energy         =      0.5164655 Ry\nExchange and correlation =     -0.8636517 Ry\n--------------------------------------------\nZeroth order energy      =      -1.769856 Ry\n\nBreakdown of total energy:\nZeroth order energy      =      -1.769856 Ry\nFirst order energy       =      0.1359589 Ry\nElectron entropy         =   3.720202e-05 Ry\n--------------------------------------------\nTotal energy             =      -1.633934 Ry\n\nBreakdown of cohesive energy:\nTotal energy             =      -1.633934 Ry\nAtom energy              =      -1.602568 Ry\n--------------------------------------------\nCohesive energy          =    -0.03136604 Ry\n\nCharge Multipoles\n=================\n             s  \n[   0]  -0.00000\n\n"
	with open(filePath, "wt") as f:
		f.write(fileStr)
	return filePath, fileStr


def createTb1OutFilePartialB_lattparamsOpt():
	filePath = os.path.join( os.getcwd(), "tb1PartialBLattParams.out" )
	fileStr = "Electrostatic potential:\n------------------------\nMg(   1):              0\nMg(   2):              0\n\nDebugging Information:\n======================\nmmicom: 2\nTestStress: -0.0000043197\nUserExit: 0\nNSteps: 23\n\n\n\nAfter relaxation:\n=================\n\nPrimitive translation vectors (a0):\n-----------------------------------\n     7.45026      0.00000      0.00000\n    -3.72513      6.45211      0.00000\n     0.00000      0.00000     12.09628\nVolume       = 581.466851 a0^3\nCell repeats =    5    4    3\n\nNumber of atoms = 2\nNeighbor cutoff =     15.00000 a0\n\nAtomic positions (a0):\n----------------------\nMg      0.00000      0.00000      0.00000\nMg      3.20399      4.76903      6.04814\n\nTotal forces (Ry/a0):\n---------------------\n                0                 0                 0\n                0                 0                 0\n"
	with open(filePath, "wt") as f:
		f.write(fileStr)
	return filePath, fileStr

def createTb2OutFilePartialB_lattparams():
	filePath = os.path.join( os.getcwd(), "tb2PartialBLattParams.out" )
	fileStr = "# l =  1 ng =   1 np =   1\n#               a                           c\n     0.99985718149445101943       1.8374666607438268073\n\nCell vectors in Bohr radii\n==========================\na1 = (      6.064889,              0,              0)\na2 = (     -3.032445,       5.252348,              0)\na3 = (             0,              0,       9.846989)\n\nb1 = (      1.035993,      0.5981311,             -0)\nb2 = (             0,       1.196262,              0)\nb3 = (             0,             -0,      0.6380819)\n\nGeometry (xyz format in Angstroms)\n==================================\n2\n\nMg              0              0              0\nMg  -1.955318e-08       1.852948         2.6054\n\nExchange and correlation functional\n===================================\nPBE\n\n"
	with open(filePath, "wt") as f:
		f.write(fileStr)
	return filePath, fileStr


def createDftOutFileA():
	filePath = os.path.join( os.getcwd(), "dftOutFile.out" )
	fileStr = "    ----------------------------------\n    | LCAO density functional theory |\n    ----------------------------------\n\nSelf-consistency parameters:\n----------------------------\nNumber of loops         = 30\nEnergy tolerance        = 0.000000\nDensity tolerance       = 0.001000\nMixing scheme           = 1\nParallelise FFT flag    = 0\nSplit density flag      = 0\nPreconditioning type    = 1\nThomas-Fermi K          = 1.000000\nMix metric type         = 0\nMix factor              = 0.200000\nNumber of mixing levels = 5\n\nEnergy functional\n-----------------\nGeneralized gradient approximation\nNo spin polarization\n\nOther parameters:\n-----------------\nDiameter of non-local pot. = 0.000000\nBasis flag                 = 0\nExcess number of electrons = 0.000000\nExternal field type        = 0\n\nK points:\n---------\n-0.4500 -0.4500 -0.4500             0.002\n 0.0500 -0.4500 -0.4500             0.002\n 0.0500 -0.4500 -0.3500             0.002\n 0.0500 -0.4500 -0.2500             0.002\n 0.0500 -0.4500 -0.1500             0.002\n 0.0500 -0.4500 -0.0500             0.002\n 0.0500 -0.4500  0.0500             0.002\n 0.0500 -0.4500  0.1500             0.002\n 0.0500 -0.4500  0.2500             0.002\n 0.0500 -0.4500  0.3500             0.002\n 0.0500 -0.4500  0.4500             0.002\n 0.0500 -0.3500 -0.4500             0.002\n 0.0500 -0.3500 -0.3500             0.002\n 0.0500 -0.3500 -0.2500             0.002\n 0.0500 -0.3500 -0.1500             0.002\n 0.0500 -0.3500 -0.0500             0.002\n 0.0500 -0.3500  0.0500             0.002\n 0.0500 -0.3500  0.1500             0.002\n 0.0500 -0.3500  0.2500             0.002\n 0.0500 -0.3500  0.3500             0.002\n 0.0500 -0.3500  0.4500             0.002\n 0.0500 -0.2500 -0.4500             0.002\n 0.0500 -0.2500 -0.3500             0.002\n 0.0500 -0.2500 -0.2500             0.002\n 0.0500 -0.2500 -0.1500             0.002\n 0.0500 -0.2500 -0.0500             0.002\n 0.0500 -0.2500  0.0500             0.002\n 0.0500 -0.2500  0.1500             0.002\n 0.0500 -0.2500  0.2500             0.002\n 0.0500 -0.2500  0.3500             0.002\n 0.0500 -0.2500  0.4500             0.002\n 0.0500 -0.1500 -0.4500             0.002\n 0.0500 -0.1500 -0.3500             0.002\n 0.0500 -0.1500 -0.2500             0.002\n 0.0500 -0.1500 -0.1500             0.002\n 0.0500 -0.1500 -0.0500             0.002\n 0.0500 -0.1500  0.0500             0.002\n 0.0500 -0.1500  0.1500             0.002\n 0.0500 -0.1500  0.2500             0.002\n 0.0500 -0.1500  0.3500             0.002\n 0.0500 -0.1500  0.4500             0.002\n 0.0500 -0.0500 -0.4500             0.002\n 0.0500 -0.0500 -0.3500             0.002\n 0.0500 -0.0500 -0.2500             0.002\n 0.0500 -0.0500 -0.1500             0.002\n 0.0500 -0.0500 -0.0500             0.002\n 0.0500 -0.0500  0.0500             0.002\n 0.0500 -0.0500  0.1500             0.002\n 0.0500 -0.0500  0.2500             0.002\n 0.0500 -0.0500  0.3500             0.002\n 0.0500 -0.0500  0.4500             0.002\n 0.0500  0.0500 -0.4500             0.002\n 0.0500  0.0500 -0.3500             0.002\n 0.0500  0.0500 -0.2500             0.002\n 0.0500  0.0500 -0.1500             0.002\n 0.0500  0.0500 -0.0500             0.002\n 0.0500  0.0500  0.0500             0.002\n 0.0500  0.0500  0.1500             0.002\n 0.0500  0.0500  0.2500             0.002\n 0.0500  0.0500  0.3500             0.002\n 0.0500  0.0500  0.4500             0.002\n 0.0500  0.1500 -0.4500             0.002\n 0.0500  0.1500 -0.3500             0.002\n 0.0500  0.1500 -0.2500             0.002\n 0.0500  0.1500 -0.1500             0.002\n 0.0500  0.1500 -0.0500             0.002\n 0.0500  0.1500  0.0500             0.002\n 0.0500  0.1500  0.1500             0.002\n 0.0500  0.1500  0.2500             0.002\n 0.0500  0.1500  0.3500             0.002\n 0.0500  0.1500  0.4500             0.002\n 0.0500  0.2500 -0.4500             0.002\n 0.0500  0.2500 -0.3500             0.002\n 0.0500  0.2500 -0.2500             0.002\n 0.0500  0.2500 -0.1500             0.002\n 0.0500  0.2500 -0.0500             0.002\n 0.0500  0.2500  0.0500             0.002\n 0.0500  0.2500  0.1500             0.002\n 0.0500  0.2500  0.2500             0.002\n 0.0500  0.2500  0.3500             0.002\n 0.0500  0.2500  0.4500             0.002\n 0.0500  0.3500 -0.4500             0.002\n 0.0500  0.3500 -0.3500             0.002\n 0.0500  0.3500 -0.2500             0.002\n 0.0500  0.3500 -0.1500             0.002\n 0.0500  0.3500 -0.0500             0.002\n 0.0500  0.3500  0.0500             0.002\n 0.0500  0.3500  0.1500             0.002\n 0.0500  0.3500  0.2500             0.002\n 0.0500  0.3500  0.3500             0.002\n 0.0500  0.3500  0.4500             0.002\n 0.0500  0.4500 -0.4500             0.002\n 0.0500  0.4500 -0.3500             0.002\n 0.0500  0.4500 -0.2500             0.002\n 0.0500  0.4500 -0.1500             0.002\n 0.0500  0.4500 -0.0500             0.002\n 0.0500  0.4500  0.0500             0.002\n 0.0500  0.4500  0.1500             0.002\n 0.0500  0.4500  0.2500             0.002\n 0.0500  0.4500  0.3500             0.002\n 0.0500  0.4500  0.4500             0.002\n 0.1500 -0.4500 -0.4500             0.002\n 0.1500 -0.4500 -0.3500             0.002\n 0.1500 -0.4500 -0.2500             0.002\n 0.1500 -0.4500 -0.1500             0.002\n 0.1500 -0.4500 -0.0500             0.002\n 0.1500 -0.4500  0.0500             0.002\n 0.1500 -0.4500  0.1500             0.002\n 0.1500 -0.4500  0.2500             0.002\n 0.1500 -0.4500  0.3500             0.002\n 0.1500 -0.4500  0.4500             0.002\n 0.1500 -0.3500 -0.4500             0.002\n 0.1500 -0.3500 -0.3500             0.002\n 0.1500 -0.3500 -0.2500             0.002\n 0.1500 -0.3500 -0.1500             0.002\n 0.1500 -0.3500 -0.0500             0.002\n 0.1500 -0.3500  0.0500             0.002\n 0.1500 -0.3500  0.1500             0.002\n 0.1500 -0.3500  0.2500             0.002\n 0.1500 -0.3500  0.3500             0.002\n 0.1500 -0.3500  0.4500             0.002\n 0.1500 -0.2500 -0.4500             0.002\n 0.1500 -0.2500 -0.3500             0.002\n 0.1500 -0.2500 -0.2500             0.002\n 0.1500 -0.2500 -0.1500             0.002\n 0.1500 -0.2500 -0.0500             0.002\n 0.1500 -0.2500  0.0500             0.002\n 0.1500 -0.2500  0.1500             0.002\n 0.1500 -0.2500  0.2500             0.002\n 0.1500 -0.2500  0.3500             0.002\n 0.1500 -0.2500  0.4500             0.002\n 0.1500 -0.1500 -0.4500             0.002\n 0.1500 -0.1500 -0.3500             0.002\n 0.1500 -0.1500 -0.2500             0.002\n 0.1500 -0.1500 -0.1500             0.002\n 0.1500 -0.1500 -0.0500             0.002\n 0.1500 -0.1500  0.0500             0.002\n 0.1500 -0.1500  0.1500             0.002\n 0.1500 -0.1500  0.2500             0.002\n 0.1500 -0.1500  0.3500             0.002\n 0.1500 -0.1500  0.4500             0.002\n 0.1500 -0.0500 -0.4500             0.002\n 0.1500 -0.0500 -0.3500             0.002\n 0.1500 -0.0500 -0.2500             0.002\n 0.1500 -0.0500 -0.1500             0.002\n 0.1500 -0.0500 -0.0500             0.002\n 0.1500 -0.0500  0.0500             0.002\n 0.1500 -0.0500  0.1500             0.002\n 0.1500 -0.0500  0.2500             0.002\n 0.1500 -0.0500  0.3500             0.002\n 0.1500 -0.0500  0.4500             0.002\n 0.1500  0.0500 -0.4500             0.002\n 0.1500  0.0500 -0.3500             0.002\n 0.1500  0.0500 -0.2500             0.002\n 0.1500  0.0500 -0.1500             0.002\n 0.1500  0.0500 -0.0500             0.002\n 0.1500  0.0500  0.0500             0.002\n 0.1500  0.0500  0.1500             0.002\n 0.1500  0.0500  0.2500             0.002\n 0.1500  0.0500  0.3500             0.002\n 0.1500  0.0500  0.4500             0.002\n 0.1500  0.1500 -0.4500             0.002\n 0.1500  0.1500 -0.3500             0.002\n 0.1500  0.1500 -0.2500             0.002\n 0.1500  0.1500 -0.1500             0.002\n 0.1500  0.1500 -0.0500             0.002\n 0.1500  0.1500  0.0500             0.002\n 0.1500  0.1500  0.1500             0.002\n 0.1500  0.1500  0.2500             0.002\n 0.1500  0.1500  0.3500             0.002\n 0.1500  0.1500  0.4500             0.002\n 0.1500  0.2500 -0.4500             0.002\n 0.1500  0.2500 -0.3500             0.002\n 0.1500  0.2500 -0.2500             0.002\n 0.1500  0.2500 -0.1500             0.002\n 0.1500  0.2500 -0.0500             0.002\n 0.1500  0.2500  0.0500             0.002\n 0.1500  0.2500  0.1500             0.002\n 0.1500  0.2500  0.2500             0.002\n 0.1500  0.2500  0.3500             0.002\n 0.1500  0.2500  0.4500             0.002\n 0.1500  0.3500 -0.4500             0.002\n 0.1500  0.3500 -0.3500             0.002\n 0.1500  0.3500 -0.2500             0.002\n 0.1500  0.3500 -0.1500             0.002\n 0.1500  0.3500 -0.0500             0.002\n 0.1500  0.3500  0.0500             0.002\n 0.1500  0.3500  0.1500             0.002\n 0.1500  0.3500  0.2500             0.002\n 0.1500  0.3500  0.3500             0.002\n 0.1500  0.3500  0.4500             0.002\n 0.1500  0.4500 -0.4500             0.002\n 0.1500  0.4500 -0.3500             0.002\n 0.1500  0.4500 -0.2500             0.002\n 0.1500  0.4500 -0.1500             0.002\n 0.1500  0.4500 -0.0500             0.002\n 0.1500  0.4500  0.0500             0.002\n 0.1500  0.4500  0.1500             0.002\n 0.1500  0.4500  0.2500             0.002\n 0.1500  0.4500  0.3500             0.002\n 0.1500  0.4500  0.4500             0.002\n 0.2500 -0.4500 -0.4500             0.002\n 0.2500 -0.4500 -0.3500             0.002\n 0.2500 -0.4500 -0.2500             0.002\n 0.2500 -0.4500 -0.1500             0.002\n 0.2500 -0.4500 -0.0500             0.002\n 0.2500 -0.4500  0.0500             0.002\n 0.2500 -0.4500  0.1500             0.002\n 0.2500 -0.4500  0.2500             0.002\n 0.2500 -0.4500  0.3500             0.002\n 0.2500 -0.4500  0.4500             0.002\n 0.2500 -0.3500 -0.4500             0.002\n 0.2500 -0.3500 -0.3500             0.002\n 0.2500 -0.3500 -0.2500             0.002\n 0.2500 -0.3500 -0.1500             0.002\n 0.2500 -0.3500 -0.0500             0.002\n 0.2500 -0.3500  0.0500             0.002\n 0.2500 -0.3500  0.1500             0.002\n 0.2500 -0.3500  0.2500             0.002\n 0.2500 -0.3500  0.3500             0.002\n 0.2500 -0.3500  0.4500             0.002\n 0.2500 -0.2500 -0.4500             0.002\n 0.2500 -0.2500 -0.3500             0.002\n 0.2500 -0.2500 -0.2500             0.002\n 0.2500 -0.2500 -0.1500             0.002\n 0.2500 -0.2500 -0.0500             0.002\n 0.2500 -0.2500  0.0500             0.002\n 0.2500 -0.2500  0.1500             0.002\n 0.2500 -0.2500  0.2500             0.002\n 0.2500 -0.2500  0.3500             0.002\n 0.2500 -0.2500  0.4500             0.002\n 0.2500 -0.1500 -0.4500             0.002\n 0.2500 -0.1500 -0.3500             0.002\n 0.2500 -0.1500 -0.2500             0.002\n 0.2500 -0.1500 -0.1500             0.002\n 0.2500 -0.1500 -0.0500             0.002\n 0.2500 -0.1500  0.0500             0.002\n 0.2500 -0.1500  0.1500             0.002\n 0.2500 -0.1500  0.2500             0.002\n 0.2500 -0.1500  0.3500             0.002\n 0.2500 -0.1500  0.4500             0.002\n 0.2500 -0.0500 -0.4500             0.002\n 0.2500 -0.0500 -0.3500             0.002\n 0.2500 -0.0500 -0.2500             0.002\n 0.2500 -0.0500 -0.1500             0.002\n 0.2500 -0.0500 -0.0500             0.002\n 0.2500 -0.0500  0.0500             0.002\n 0.2500 -0.0500  0.1500             0.002\n 0.2500 -0.0500  0.2500             0.002\n 0.2500 -0.0500  0.3500             0.002\n 0.2500 -0.0500  0.4500             0.002\n 0.2500  0.0500 -0.4500             0.002\n 0.2500  0.0500 -0.3500             0.002\n 0.2500  0.0500 -0.2500             0.002\n 0.2500  0.0500 -0.1500             0.002\n 0.2500  0.0500 -0.0500             0.002\n 0.2500  0.0500  0.0500             0.002\n 0.2500  0.0500  0.1500             0.002\n 0.2500  0.0500  0.2500             0.002\n 0.2500  0.0500  0.3500             0.002\n 0.2500  0.0500  0.4500             0.002\n 0.2500  0.1500 -0.4500             0.002\n 0.2500  0.1500 -0.3500             0.002\n 0.2500  0.1500 -0.2500             0.002\n 0.2500  0.1500 -0.1500             0.002\n 0.2500  0.1500 -0.0500             0.002\n 0.2500  0.1500  0.0500             0.002\n 0.2500  0.1500  0.1500             0.002\n 0.2500  0.1500  0.2500             0.002\n 0.2500  0.1500  0.3500             0.002\n 0.2500  0.1500  0.4500             0.002\n 0.2500  0.2500 -0.4500             0.002\n 0.2500  0.2500 -0.3500             0.002\n 0.2500  0.2500 -0.2500             0.002\n 0.2500  0.2500 -0.1500             0.002\n 0.2500  0.2500 -0.0500             0.002\n 0.2500  0.2500  0.0500             0.002\n 0.2500  0.2500  0.1500             0.002\n 0.2500  0.2500  0.2500             0.002\n 0.2500  0.2500  0.3500             0.002\n 0.2500  0.2500  0.4500             0.002\n 0.2500  0.3500 -0.4500             0.002\n 0.2500  0.3500 -0.3500             0.002\n 0.2500  0.3500 -0.2500             0.002\n 0.2500  0.3500 -0.1500             0.002\n 0.2500  0.3500 -0.0500             0.002\n 0.2500  0.3500  0.0500             0.002\n 0.2500  0.3500  0.1500             0.002\n 0.2500  0.3500  0.2500             0.002\n 0.2500  0.3500  0.3500             0.002\n 0.2500  0.3500  0.4500             0.002\n 0.2500  0.4500 -0.4500             0.002\n 0.2500  0.4500 -0.3500             0.002\n 0.2500  0.4500 -0.2500             0.002\n 0.2500  0.4500 -0.1500             0.002\n 0.2500  0.4500 -0.0500             0.002\n 0.2500  0.4500  0.0500             0.002\n 0.2500  0.4500  0.1500             0.002\n 0.2500  0.4500  0.2500             0.002\n 0.2500  0.4500  0.3500             0.002\n 0.2500  0.4500  0.4500             0.002\n 0.3500 -0.4500 -0.4500             0.002\n 0.3500 -0.4500 -0.3500             0.002\n 0.3500 -0.4500 -0.2500             0.002\n 0.3500 -0.4500 -0.1500             0.002\n 0.3500 -0.4500 -0.0500             0.002\n 0.3500 -0.4500  0.0500             0.002\n 0.3500 -0.4500  0.1500             0.002\n 0.3500 -0.4500  0.2500             0.002\n 0.3500 -0.4500  0.3500             0.002\n 0.3500 -0.4500  0.4500             0.002\n 0.3500 -0.3500 -0.4500             0.002\n 0.3500 -0.3500 -0.3500             0.002\n 0.3500 -0.3500 -0.2500             0.002\n 0.3500 -0.3500 -0.1500             0.002\n 0.3500 -0.3500 -0.0500             0.002\n 0.3500 -0.3500  0.0500             0.002\n 0.3500 -0.3500  0.1500             0.002\n 0.3500 -0.3500  0.2500             0.002\n 0.3500 -0.3500  0.3500             0.002\n 0.3500 -0.3500  0.4500             0.002\n 0.3500 -0.2500 -0.4500             0.002\n 0.3500 -0.2500 -0.3500             0.002\n 0.3500 -0.2500 -0.2500             0.002\n 0.3500 -0.2500 -0.1500             0.002\n 0.3500 -0.2500 -0.0500             0.002\n 0.3500 -0.2500  0.0500             0.002\n 0.3500 -0.2500  0.1500             0.002\n 0.3500 -0.2500  0.2500             0.002\n 0.3500 -0.2500  0.3500             0.002\n 0.3500 -0.2500  0.4500             0.002\n 0.3500 -0.1500 -0.4500             0.002\n 0.3500 -0.1500 -0.3500             0.002\n 0.3500 -0.1500 -0.2500             0.002\n 0.3500 -0.1500 -0.1500             0.002\n 0.3500 -0.1500 -0.0500             0.002\n 0.3500 -0.1500  0.0500             0.002\n 0.3500 -0.1500  0.1500             0.002\n 0.3500 -0.1500  0.2500             0.002\n 0.3500 -0.1500  0.3500             0.002\n 0.3500 -0.1500  0.4500             0.002\n 0.3500 -0.0500 -0.4500             0.002\n 0.3500 -0.0500 -0.3500             0.002\n 0.3500 -0.0500 -0.2500             0.002\n 0.3500 -0.0500 -0.1500             0.002\n 0.3500 -0.0500 -0.0500             0.002\n 0.3500 -0.0500  0.0500             0.002\n 0.3500 -0.0500  0.1500             0.002\n 0.3500 -0.0500  0.2500             0.002\n 0.3500 -0.0500  0.3500             0.002\n 0.3500 -0.0500  0.4500             0.002\n 0.3500  0.0500 -0.4500             0.002\n 0.3500  0.0500 -0.3500             0.002\n 0.3500  0.0500 -0.2500             0.002\n 0.3500  0.0500 -0.1500             0.002\n 0.3500  0.0500 -0.0500             0.002\n 0.3500  0.0500  0.0500             0.002\n 0.3500  0.0500  0.1500             0.002\n 0.3500  0.0500  0.2500             0.002\n 0.3500  0.0500  0.3500             0.002\n 0.3500  0.0500  0.4500             0.002\n 0.3500  0.1500 -0.4500             0.002\n 0.3500  0.1500 -0.3500             0.002\n 0.3500  0.1500 -0.2500             0.002\n 0.3500  0.1500 -0.1500             0.002\n 0.3500  0.1500 -0.0500             0.002\n 0.3500  0.1500  0.0500             0.002\n 0.3500  0.1500  0.1500             0.002\n 0.3500  0.1500  0.2500             0.002\n 0.3500  0.1500  0.3500             0.002\n 0.3500  0.1500  0.4500             0.002\n 0.3500  0.2500 -0.4500             0.002\n 0.3500  0.2500 -0.3500             0.002\n 0.3500  0.2500 -0.2500             0.002\n 0.3500  0.2500 -0.1500             0.002\n 0.3500  0.2500 -0.0500             0.002\n 0.3500  0.2500  0.0500             0.002\n 0.3500  0.2500  0.1500             0.002\n 0.3500  0.2500  0.2500             0.002\n 0.3500  0.2500  0.3500             0.002\n 0.3500  0.2500  0.4500             0.002\n 0.3500  0.3500 -0.4500             0.002\n 0.3500  0.3500 -0.3500             0.002\n 0.3500  0.3500 -0.2500             0.002\n 0.3500  0.3500 -0.1500             0.002\n 0.3500  0.3500 -0.0500             0.002\n 0.3500  0.3500  0.0500             0.002\n 0.3500  0.3500  0.1500             0.002\n 0.3500  0.3500  0.2500             0.002\n 0.3500  0.3500  0.3500             0.002\n 0.3500  0.3500  0.4500             0.002\n 0.3500  0.4500 -0.4500             0.002\n 0.3500  0.4500 -0.3500             0.002\n 0.3500  0.4500 -0.2500             0.002\n 0.3500  0.4500 -0.1500             0.002\n 0.3500  0.4500 -0.0500             0.002\n 0.3500  0.4500  0.0500             0.002\n 0.3500  0.4500  0.1500             0.002\n 0.3500  0.4500  0.2500             0.002\n 0.3500  0.4500  0.3500             0.002\n 0.3500  0.4500  0.4500             0.002\n 0.4500 -0.4500 -0.4500             0.002\n 0.4500 -0.4500 -0.3500             0.002\n 0.4500 -0.4500 -0.2500             0.002\n 0.4500 -0.4500 -0.1500             0.002\n 0.4500 -0.4500 -0.0500             0.002\n 0.4500 -0.4500  0.0500             0.002\n 0.4500 -0.4500  0.1500             0.002\n 0.4500 -0.4500  0.2500             0.002\n 0.4500 -0.4500  0.3500             0.002\n 0.4500 -0.4500  0.4500             0.002\n 0.4500 -0.3500 -0.4500             0.002\n 0.4500 -0.3500 -0.3500             0.002\n 0.4500 -0.3500 -0.2500             0.002\n 0.4500 -0.3500 -0.1500             0.002\n 0.4500 -0.3500 -0.0500             0.002\n 0.4500 -0.3500  0.0500             0.002\n 0.4500 -0.3500  0.1500             0.002\n 0.4500 -0.3500  0.2500             0.002\n 0.4500 -0.3500  0.3500             0.002\n 0.4500 -0.3500  0.4500             0.002\n 0.4500 -0.2500 -0.4500             0.002\n 0.4500 -0.2500 -0.3500             0.002\n 0.4500 -0.2500 -0.2500             0.002\n 0.4500 -0.2500 -0.1500             0.002\n 0.4500 -0.2500 -0.0500             0.002\n 0.4500 -0.2500  0.0500             0.002\n 0.4500 -0.2500  0.1500             0.002\n 0.4500 -0.2500  0.2500             0.002\n 0.4500 -0.2500  0.3500             0.002\n 0.4500 -0.2500  0.4500             0.002\n 0.4500 -0.1500 -0.4500             0.002\n 0.4500 -0.1500 -0.3500             0.002\n 0.4500 -0.1500 -0.2500             0.002\n 0.4500 -0.1500 -0.1500             0.002\n 0.4500 -0.1500 -0.0500             0.002\n 0.4500 -0.1500  0.0500             0.002\n 0.4500 -0.1500  0.1500             0.002\n 0.4500 -0.1500  0.2500             0.002\n 0.4500 -0.1500  0.3500             0.002\n 0.4500 -0.1500  0.4500             0.002\n 0.4500 -0.0500 -0.4500             0.002\n 0.4500 -0.0500 -0.3500             0.002\n 0.4500 -0.0500 -0.2500             0.002\n 0.4500 -0.0500 -0.1500             0.002\n 0.4500 -0.0500 -0.0500             0.002\n 0.4500 -0.0500  0.0500             0.002\n 0.4500 -0.0500  0.1500             0.002\n 0.4500 -0.0500  0.2500             0.002\n 0.4500 -0.0500  0.3500             0.002\n 0.4500 -0.0500  0.4500             0.002\n 0.4500  0.0500 -0.4500             0.002\n 0.4500  0.0500 -0.3500             0.002\n 0.4500  0.0500 -0.2500             0.002\n 0.4500  0.0500 -0.1500             0.002\n 0.4500  0.0500 -0.0500             0.002\n 0.4500  0.0500  0.0500             0.002\n 0.4500  0.0500  0.1500             0.002\n 0.4500  0.0500  0.2500             0.002\n 0.4500  0.0500  0.3500             0.002\n 0.4500  0.0500  0.4500             0.002\n 0.4500  0.1500 -0.4500             0.002\n 0.4500  0.1500 -0.3500             0.002\n 0.4500  0.1500 -0.2500             0.002\n 0.4500  0.1500 -0.1500             0.002\n 0.4500  0.1500 -0.0500             0.002\n 0.4500  0.1500  0.0500             0.002\n 0.4500  0.1500  0.1500             0.002\n 0.4500  0.1500  0.2500             0.002\n 0.4500  0.1500  0.3500             0.002\n 0.4500  0.1500  0.4500             0.002\n 0.4500  0.2500 -0.4500             0.002\n 0.4500  0.2500 -0.3500             0.002\n 0.4500  0.2500 -0.2500             0.002\n 0.4500  0.2500 -0.1500             0.002\n 0.4500  0.2500 -0.0500             0.002\n 0.4500  0.2500  0.0500             0.002\n 0.4500  0.2500  0.1500             0.002\n 0.4500  0.2500  0.2500             0.002\n 0.4500  0.2500  0.3500             0.002\n 0.4500  0.2500  0.4500             0.002\n 0.4500  0.3500 -0.4500             0.002\n 0.4500  0.3500 -0.3500             0.002\n 0.4500  0.3500 -0.2500             0.002\n 0.4500  0.3500 -0.1500             0.002\n 0.4500  0.3500 -0.0500             0.002\n 0.4500  0.3500  0.0500             0.002\n 0.4500  0.3500  0.1500             0.002\n 0.4500  0.3500  0.2500             0.002\n 0.4500  0.3500  0.3500             0.002\n 0.4500  0.3500  0.4500             0.002\n 0.4500  0.4500 -0.4500             0.002\n 0.4500  0.4500 -0.3500             0.002\n 0.4500  0.4500 -0.2500             0.002\n 0.4500  0.4500 -0.1500             0.002\n 0.4500  0.4500 -0.0500             0.002\n 0.4500  0.4500  0.0500             0.002\n 0.4500  0.4500  0.1500             0.002\n 0.4500  0.4500  0.2500             0.002\n 0.4500  0.4500  0.3500             0.002\n\nAtomic relaxation parameters:\n-----------------------------\nRelaxation method       = 3\nForce tolerance         = 0.000100Ry/a0\nMaximum number of steps = 1000\n\nAtomic data:\n------------\nAtom Type #    1\n----------------\nChemical symbol           : Mg\nCore charge               : 2.000000\nNumber of angular momenta : 3\nNumber of orbitals        : 9\nAtomic radius             : 6.000000\nAtomic energy correction  : -1.435150\n  n l m     energy     occupancy    radius\n  3 0 0   -0.043279     2.000000     6.000000\n  3 1 0   0.349847     0.000000     6.000000\n  3 1 1   0.349847     0.000000     6.000000\n  3 1 2   0.349847     0.000000     6.000000\n  3 2 0   0.878371     0.000000     6.000000\n  3 2 1   0.878371     0.000000     6.000000\n  3 2 2   0.878371     0.000000     6.000000\n  3 2 3   0.878371     0.000000     6.000000\n  3 2 4   0.878371     0.000000     6.000000\n\nOrbital and electron count:\n---------------------------\nNumber of orbitals  = 9\nNumber of electrons = 2.000000\n\nDiagonalizer information:\n-------------------------\nUsing Lapack\n\nFFT integral grid being used.\n-----------------------------\nFFT grid spacing = 0.548509\nFFT grid size    =   12   12   12\n\nscf :  0) E =      -1.735770599 Ry  dRho = 28.0277\nscf :  1) E =      -1.737147192 Ry  dRho = 24.1157\nscf :  2) E =      -1.738884976 Ry  dRho = 2.95901\nscf :  3) E =       -1.73931942 Ry  dRho = 0.869798\nscf :  4) E =      -1.739322087 Ry  dRho = 0.179336\nscf :  5) E =      -1.739322264 Ry  dRho = 0.0386397\nscf :  6) E =      -1.739322269 Ry  dRho = 0.00844228\nscf :  7) E =       -1.73932227 Ry  dRho = 0.000491891\n\nPrimitive translation vectors (a0):\n-----------------------------------\n     5.59200      0.00000      0.00000\n    -1.86400      5.27219      0.00000\n    -1.86400     -2.63609      4.56585\nVolume       = 134.610679 a0^3\nCell repeats =    6    5    4\n\nNumber of atoms = 1\nNeighbor cutoff =     12.00000 a0\n\nAtomic positions (a0):\n----------------------\nMg      0.00000      0.00000      0.00000\n\nTotal forces (Ry/a0):\n---------------------\n                0                 0                 0\n\nStress Tensor (MBars):\n----------------------\n    -0.1017685675   3.274190267e-06   5.671358449e-06\n  3.274190267e-06     -0.1017662523   8.019479171e-06\n  5.671358425e-06    8.01947913e-06      -0.101756992\n\nEFermi =     -0.0767951 Ry\n(kT    =      0.0010000 Ry)\n\nEatom            =     -1.4351500 Ry\nE0               =      0.0384321 Ry\nBand             =     -0.6107085 Ry\nEntropy          =      0.0000486 Ry\nDouble Count     =      0.2681527 Ry\n------------------------------------\nTotal (Free)     =     -1.7393223 Ry\n                 =    -23.6648709 eV\n                 =   -547.1038200 kCal/mol\n                 =  -2288.9481073 kJ/mol\n------------------------------------\nTotal (Internal) =     -1.7392737 Ry\n                 =    -23.6642099 eV\n                 =   -547.0885368 kCal/mol\n                 =  -2288.8841662 kJ/mol\n------------------------------------\nTotal (kT->0)    =     -1.7392980 Ry\n                 =    -23.6645404 eV\n                 =   -547.0961784 kCal/mol\n                 =  -2288.9161368 kJ/mol\n\nTotal energy breakdown\n----------------------\nKinetic                    =      0.7712240 Ry\nNeutral atom               =     -0.6391693 Ry\nElectrostatic (atomic)     =     -1.3967179 Ry\nElectrostatic (correction) =      0.0127755 Ry\nExchange and correlation   =     -0.8886980 Ry\nNon-local pseudopotential  =      0.4065674 Ry\n---------------------------------------------\nSum                        =     -1.7340183 Ry\n\nNet atomic charges (Mulliken):\n------------------------------\nMg(   1) =      0.00000\n\nOrbital populations (Mulliken):\n-------------------------------\nMg(   1):  0.87  0.31  0.31  0.31  0.04  0.04  0.04  0.03  0.03 \n\nMemory allocation (KBytes):\n===========================\nFFTGridR                41\nFFTGridG                54\nMixStack               135\nFFTRho0                 14\nFFTRho                  27\nFFTV                    27\nFFTVna                  14\nhh                       0\nss                       0\nh_k                      1\ns_k                      1\nEigVec                   0\nEigVecK                633\nH                       75\nFock                    37\nRho                     37\nS                       37\nEMatrix                 37\nIntTab                3140\nDiag work arr            0\nACGGridR                 0\nACGGridWeight            0\nACGGridVna               0\nACGGridVtot              0\nACGGridRho               0\nACGGridZeta              0\nACGGridRho0              0\nACGGridRhoFit            0\nACGGridRhoPW             0\nACGGridStack             0\nACGGridMoments           0\nFFTVxc                  14\nFFTVHa                  14\nFFTZeta                  0\nFFTSpinMix               0\n--------------------------\nTotal                 4338\n--------------------------\n\nTime distribution (s):\n======================\nBuildFock                   0.00\nDiagFock                    1.00\nBuildForce                  0.00\nBuild Initial Fock          0.00\nBuild Rho                   0.00\nBuild Density               1.00\nBuild Potential             0.00\n\n\nWall time =       2.0s        0.0m        0.0h\nCPU time  =       2.1s        0.0m        0.0h\n\n"
	with open(filePath, "wt") as f:
		f.write(fileStr)
	return filePath

if __name__=='__main__':
	unittest.main()

