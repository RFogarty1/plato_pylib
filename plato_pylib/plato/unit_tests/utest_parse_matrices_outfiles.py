#!/usr/bin/python3

import os
import numpy as np
import unittest

import plato_pylib.plato.parse_matrices_out_files as tCode
import plato_pylib.shared.utest_helpers as utestHelpers


class TestForBccGammaPointOnly(unittest.TestCase):

	def setUp(self):
		self.testFilePath = createSiBccGammaPointDft2OutFileA()
		self.testFilePathNoMatrix = createSiBccDft2WithoutMatrixA()

	def tearDown(self):
		os.remove(self.testFilePath)
		os.remove(self.testFilePathNoMatrix)

#	@utestHelpers.debug_on(Exception)
	def testExpectedOverlapMatrixReturned(self):
		expArray = loadExpOverlapMatrix_SiBccGammaPointDft2OutFileA()
		actArray = tCode._getMatricesFromDft2Outfile(self.testFilePath)[0].overlap
		self.assertTrue( np.allclose(expArray,actArray, atol=1e-6) )


	def testRaisesWhenNoMatrixPresent(self):
		with self.assertRaises(tCode.InfoNotFoundError):
			tCode._getMatricesFromDft2Outfile(self.testFilePathNoMatrix)


class TestForHcp(unittest.TestCase):

	def setUp(self):
		self.testFilePath = createSiHcpDft2OutFile()

	def teardown(self):
		os.remove(self.testFilePath)

#	@utestHelpers.debug_on(Exception)
	def testExpectedOverlapMatrixReturned(self):
		expArray = loadExpHamilMatrixState2_SiHcpDft2OutFileA()
		allStates = tCode._getMatricesFromDft2Outfile(self.testFilePath)
		actArray = allStates[-1].hamil
		self.assertTrue(np.allclose(expArray,actArray, atol=1e-6))


def loadExpHamilMatrixState2_SiHcpDft2OutFileA():
	outArray = np.zeros( (8,8), dtype=complex)	

	outArray[0,0] = complex(-0.6134563)
	outArray[0,2] = complex(0.001454626)
	outArray[0,3] = complex(-0.0008416529)
	outArray[0,5] = complex(0.1868637)
	outArray[1,1] = complex(-0.2476471,0.5) #the imaginary component was modified in the output from the true calculated val
	outArray[1,4] = complex(-0.1868637)
	outArray[1,6] = complex(-0.3611466)
	outArray[1,7] = complex(0.2085158)
	outArray[2,0] = complex(0.001454626)
	outArray[2,2] = complex(-0.6737121)
	outArray[2,3] = complex(0.3774664)
	outArray[2,5] = complex(-0.3611466)
	outArray[3,0] = complex(-0.0008416529)
	outArray[3,2] = complex(0.3774664)
	outArray[3,3] = complex(-0.2378869)
	outArray[3,5] = complex(0.2085158)
	outArray[4,1] = complex(-0.1868637)
	outArray[4,4] = complex(-0.6134564)
	outArray[4,6] = complex(-0.001454626)
	outArray[4,7] = complex(0.000841652)
	outArray[5,0] = complex(0.1868637)
	outArray[5,2] = outArray[2,5]
	outArray[5,3] = outArray[3,5]
	outArray[5,5] = complex(-0.2476471)
	outArray[6,1] = outArray[1,6]
	outArray[6,4] = outArray[4,6]
	outArray[6,6] = complex(-0.6737121)
	outArray[6,7] = complex(0.3774664)
	outArray[7,1] = outArray[1,7]
	outArray[7,4] = outArray[4,7]
	outArray[7,6] = outArray[6,7]
	outArray[7,7] = complex(-0.2378869)

	return outArray

#TODO: Refactor these functions into a class
def loadExpOverlapMatrix_SiBccGammaPointDft2OutFileA():
	outArray = np.zeros( (4,4), dtype=complex )
	outArray[0,0] = complex(1.409208)
	outArray[1,1] = complex(0.5618671)
	outArray[2,2] = complex(0.5618671)
	outArray[3,3] = complex(0.5618671)
	return outArray

def createSiHcpDft2OutFile():
	outPath = "testHcpDft2OutFile.out"
	with open(outPath,"wt") as f:
		f.write("    -----------------------------\n    | Density Functional Theory |\n    -----------------------------\n\n\nModel characteristics\n---------------------\nTabulated tight binding\nOverlap                 : 1\nCrystal field           : 1\nCrystal field correction: 0\nThree centre            : 0\nGaussian expansions\n===================\nAtom: Si\n--------\nOrbitals\n# l =  0 ng =   5\n#               a                           c\n     0.32043626491847215787       8.5356114316553099997\n     0.38797113579531211647      -24.895981596431024485\n     0.46998578963933906882       26.930256567032994752\n     0.57073673549305314889      -11.093819619116793262\n     0.73256953769067001403      0.52592505367091202384\n# l =  1 ng =   5\n#               a                           c\n     0.31987789145788841916       5.6359855523392603516\n     0.38388650455871509148      -14.820816124992456153\n     0.46704092355763748845       13.714861173542418626\n     0.60792740433717662452      -5.1567435543407542653\n     0.74674281141793452665       0.7814013948849088953\n\nDensity\n# ng =  10 np =   1\n#               a                           c\n     0.33312962173152449452       2.2806863321691452917\n     0.40203906396780392241      -10.173492052631981863\n     0.48337204068840278204       20.040608194931582631\n     0.58603889316855128921        -19.5730360969880266\n     0.81790391037392473628       19.304846186109678285\n      1.0192016450425376295      -19.810251699259815439\n      1.3298970981482607367       12.777696752831733562\n      1.7367203322291819845      -7.5858843831037727767\n      2.1634013670897007664       3.0756073390439451209\n      2.8921250919795071788     -0.33680747969040991663\n\nNeutral atom potential\n# ng =  10 np =   1\n#               a                           c\n     0.32120810150732020949      -10.634079724334942085\n     0.38901882733097142841       52.110190303751927843\n     0.49583076272399262407      -226.89366325210832542\n     0.60360661407919724564       534.38188413330226467\n     0.75072913530670093429      -882.78134380649680679\n     0.93346203151021545086       1187.7002960180916489\n       1.120768003823935377      -1031.7543430689008801\n      1.3938656778816160831       536.04048635685296631\n      1.6808076751381300085      -179.08517083643667434\n      3.4532372804028792501      -2.1911642048283463957\n\nNon-local pseudopotential\n# l =  0 ng =   1 np =   2\n#               a                           c\n      2.6346735529478948479      -1.2241902661681349773      -8.0897926897950593883\n# l =  0 ng =   1 np =   2\n#               a                           c\n      2.6346735320909129285      -6.1149204739210514248       6.8514853811027336405\n# l =  1 ng =   1 np =   1\n#               a                           c\n      2.0165647487931699366       7.5533132405112128893\n\nCell vectors in Bohr radii\n==========================\na1 = (          5.81,              0,              0)\na2 = (     -2.904952,       5.031552,              0)\na3 = (             0,              0,       9.433142)\n\nb1 = (      1.081443,      0.6243681,             -0)\nb2 = (             0,       1.248757,              0)\nb3 = (             0,             -0,      0.6660756)\n\nGeometry (xyz format in Angstroms)\n==================================\n2\n\nSi              0              0              0\nSi   1.546099e-05       1.775055       2.495901\n\nExchange and correlation functional\n===================================\nPBE\nExact functional\n\nIntegral mesh\n=============\nType                   : atom centered spherical mesh\nNumber of r points     : 60\nNumber of theta points : 50\nNumber of phi points   : 50\n\nHamiltonian (Ry) and overlap\n============================\n\nState:    1\n-----------\n\natom 1:    1   atom 2:    1\n\n[ 0,  0]      -1.329418 + i              0           1.347654 + i              0\n[ 0,  1]  -1.484892e-16 + i              0                  0 + i              0\n[ 0,  2]  -4.458718e-07 + i              0      -4.187519e-19 + i              0\n[ 0,  3]   -4.47241e-07 + i              0      -2.283813e-18 + i              0\n[ 1,  0]  -1.484892e-16 + i             -0                  0 + i             -0\n[ 1,  1]     -0.5687487 + i              0           1.213546 + i              0\n[ 1,  2]   6.148049e-18 + i              0                  0 + i              0\n[ 1,  3]   8.236172e-16 + i              0                  0 + i              0\n[ 2,  0]  -4.458718e-07 + i             -0      -4.187519e-19 + i             -0\n[ 2,  1]   6.148049e-18 + i             -0                  0 + i             -0\n[ 2,  2]     0.08269916 + i              0          0.4512655 + i              0\n[ 2,  3]  -1.143746e-06 + i              0       5.116764e-06 + i              0\n[ 3,  0]   -4.47241e-07 + i             -0      -2.283813e-18 + i             -0\n[ 3,  1]   8.236172e-16 + i             -0                  0 + i             -0\n[ 3,  2]  -1.143746e-06 + i             -0       5.116764e-06 + i             -0\n[ 3,  3]     0.08270818 + i              0          0.4512537 + i              0\n\natom 1:    1   atom 2:    2\n\n[ 0,  0]     -0.5818685 + i              0          0.3660273 + i              0\n[ 0,  1]  -2.272488e-16 + i              0                  0 + i              0\n[ 0,  2]   1.213533e-06 + i              0        -1.6663e-06 + i              0\n[ 0,  3]  -3.449824e-07 + i              0      -1.792381e-06 + i              0\n[ 1,  0]   1.977856e-16 + i              0                  0 + i              0\n[ 1,  1]      0.6774998 + i              0         -0.8332016 + i              0\n[ 1,  2]   1.386071e-15 + i              0       8.673617e-19 + i              0\n[ 1,  3]  -1.911665e-15 + i              0                  0 + i              0\n[ 2,  0]  -1.213536e-06 + i              0         1.6663e-06 + i              0\n[ 2,  1]   2.654127e-15 + i              0       8.673617e-19 + i              0\n[ 2,  2]     0.02142525 + i              0        -0.06211064 + i              0\n[ 2,  3]   3.421657e-07 + i              0      -4.201033e-07 + i              0\n[ 3,  0]   3.449791e-07 + i              0       1.792381e-06 + i              0\n[ 3,  1]  -1.509101e-15 + i              0      -1.387779e-17 + i              0\n[ 3,  2]   3.421657e-07 + i              0      -4.201033e-07 + i              0\n[ 3,  3]     0.02142794 + i              0          -0.062109 + i              0\n\natom 1:    2   atom 2:    1\n\n[ 0,  0]     -0.5818685 + i             -0          0.3660273 + i             -0\n[ 0,  1]   1.977856e-16 + i             -0                  0 + i             -0\n[ 0,  2]  -1.213536e-06 + i             -0         1.6663e-06 + i             -0\n[ 0,  3]   3.449791e-07 + i             -0       1.792381e-06 + i             -0\n[ 1,  0]  -2.272488e-16 + i             -0                  0 + i             -0\n[ 1,  1]      0.6774998 + i             -0         -0.8332016 + i             -0\n[ 1,  2]   2.654127e-15 + i             -0       8.673617e-19 + i             -0\n[ 1,  3]  -1.509101e-15 + i             -0      -1.387779e-17 + i             -0\n[ 2,  0]   1.213533e-06 + i             -0        -1.6663e-06 + i             -0\n[ 2,  1]   1.386071e-15 + i             -0       8.673617e-19 + i             -0\n[ 2,  2]     0.02142525 + i             -0        -0.06211064 + i             -0\n[ 2,  3]   3.421657e-07 + i             -0      -4.201033e-07 + i             -0\n[ 3,  0]  -3.449824e-07 + i             -0      -1.792381e-06 + i             -0\n[ 3,  1]  -1.911665e-15 + i             -0                  0 + i             -0\n[ 3,  2]   3.421657e-07 + i             -0      -4.201033e-07 + i             -0\n[ 3,  3]     0.02142794 + i             -0          -0.062109 + i             -0\n\natom 1:    2   atom 2:    2\n\n[ 0,  0]      -1.329418 + i              0           1.347654 + i              0\n[ 0,  1]   8.063079e-10 + i              0      -3.231435e-12 + i              0\n[ 0,  2]   4.458695e-07 + i              0        8.18635e-16 + i              0\n[ 0,  3]   4.463164e-07 + i              0       2.054863e-13 + i              0\n[ 1,  0]   8.063079e-10 + i             -0      -3.231435e-12 + i             -0\n[ 1,  1]     -0.5687487 + i              0           1.213546 + i              0\n[ 1,  2]   1.601266e-13 + i              0      -4.681965e-21 + i              0\n[ 1,  3]  -5.518238e-13 + i              0      -4.115139e-21 + i              0\n[ 2,  0]   4.458695e-07 + i             -0        8.18635e-16 + i             -0\n[ 2,  1]   1.601266e-13 + i             -0      -4.681965e-21 + i             -0\n[ 2,  2]     0.08269916 + i              0          0.4512655 + i              0\n[ 2,  3]  -1.143748e-06 + i              0       5.116764e-06 + i              0\n[ 3,  0]   4.463164e-07 + i             -0       2.054863e-13 + i             -0\n[ 3,  1]  -5.518238e-13 + i             -0      -4.115139e-21 + i             -0\n[ 3,  2]  -1.143748e-06 + i             -0       5.116764e-06 + i             -0\n[ 3,  3]     0.08270819 + i              0          0.4512537 + i              0\n\nState:    2\n-----------\n\natom 1:    1   atom 2:    1\n\n[ 0,  0]     -0.6134563 + i   -1.27879e-27            0.88398 + i   5.143196e-31\n[ 0,  1]   5.123624e-17 + i   2.693026e-15                  0 + i  -5.239259e-16\n[ 0,  2]    0.001454626 + i  -1.101068e-13      -2.425691e-19 + i    9.24825e-14\n[ 0,  3]  -0.0008416529 + i  -1.906746e-13       3.028778e-18 + i   1.601539e-13\n[ 1,  0]   5.123624e-17 + i  -2.693026e-15                  0 + i   5.239259e-16\n[ 1,  1]     -0.2476471 + i   0.5          0.9301216 + i  -2.289762e-30\n[ 1,  2]   3.758096e-16 + i   3.216724e-17                  0 + i              0\n[ 1,  3]   9.038692e-16 + i  -1.846604e-17                  0 + i              0\n[ 2,  0]    0.001454626 + i   1.101068e-13      -2.425691e-19 + i   -9.24825e-14\n[ 2,  1]   3.758096e-16 + i  -3.216724e-17                  0 + i             -0\n[ 2,  2]     -0.6737121 + i  -1.675485e-27           1.437192 + i  -1.421124e-29\n[ 2,  3]      0.3774664 + i   5.333161e-15          -0.440598 + i  -8.301914e-30\n[ 3,  0]  -0.0008416529 + i   1.906746e-13       3.028778e-18 + i  -1.601539e-13\n[ 3,  1]   9.038692e-16 + i   1.846604e-17                  0 + i             -0\n[ 3,  2]      0.3774664 + i  -5.333161e-15          -0.440598 + i   8.301914e-30\n[ 3,  3]     -0.2378869 + i   -1.58561e-27          0.9284792 + i  -5.830945e-30\n\natom 1:    1   atom 2:    2\n\n[ 0,  0]    7.02563e-17 + i   5.866678e-14                  0 + i  -4.313818e-14\n[ 0,  1]      0.1868637 + i   2.224176e-13         -0.1788897 + i  -2.129326e-13\n[ 0,  2]   5.162645e-15 + i   1.133829e-13       1.734723e-18 + i  -9.492111e-14\n[ 0,  3]   8.456777e-16 + i  -6.550587e-14       1.387779e-17 + i   5.483665e-14\n[ 1,  0]     -0.1868637 + i  -2.224176e-13          0.1788897 + i   2.129326e-13\n[ 1,  1]   1.006248e-14 + i   -6.20089e-14       2.775558e-17 + i   9.899279e-14\n[ 1,  2]     -0.3611466 + i  -5.322796e-13          0.4237011 + i   6.563027e-13\n[ 1,  3]      0.2085158 + i   7.099942e-14         -0.2446311 + i  -2.816924e-14\n[ 2,  0]  -4.717011e-15 + i  -1.133829e-13      -1.734723e-18 + i   9.492111e-14\n[ 2,  1]     -0.3611466 + i  -5.322796e-13          0.4237011 + i   6.563027e-13\n[ 2,  2]  -9.356665e-15 + i   5.454863e-14      -6.938894e-18 + i  -3.770224e-14\n[ 2,  3]   1.631182e-16 + i    -5.0914e-14      -2.602085e-18 + i    5.98862e-14\n[ 3,  0]  -1.647386e-14 + i   6.550587e-14                  0 + i  -5.483665e-14\n[ 3,  1]      0.2085158 + i   7.099942e-14         -0.2446311 + i  -2.816924e-14\n[ 3,  2]   2.544839e-15 + i    -5.0914e-14      -2.602085e-18 + i    5.98862e-14\n[ 3,  3]   1.293236e-15 + i  -4.262221e-15       6.938894e-18 + i   3.148186e-14\n\natom 1:    2   atom 2:    1\n\n[ 0,  0]    7.02563e-17 + i  -5.866678e-14                  0 + i   4.313818e-14\n[ 0,  1]     -0.1868637 + i   2.224176e-13          0.1788897 + i  -2.129326e-13\n[ 0,  2]  -4.717011e-15 + i   1.133829e-13      -1.734723e-18 + i  -9.492111e-14\n[ 0,  3]  -1.647386e-14 + i  -6.550587e-14                  0 + i   5.483665e-14\n[ 1,  0]      0.1868637 + i  -2.224176e-13         -0.1788897 + i   2.129326e-13\n[ 1,  1]   1.006248e-14 + i    6.20089e-14       2.775558e-17 + i  -9.899279e-14\n[ 1,  2]     -0.3611466 + i   5.322796e-13          0.4237011 + i  -6.563027e-13\n[ 1,  3]      0.2085158 + i  -7.099942e-14         -0.2446311 + i   2.816924e-14\n[ 2,  0]   5.162645e-15 + i  -1.133829e-13       1.734723e-18 + i   9.492111e-14\n[ 2,  1]     -0.3611466 + i   5.322796e-13          0.4237011 + i  -6.563027e-13\n[ 2,  2]  -9.356665e-15 + i  -5.454863e-14      -6.938894e-18 + i   3.770224e-14\n[ 2,  3]   2.544839e-15 + i     5.0914e-14      -2.602085e-18 + i   -5.98862e-14\n[ 3,  0]   8.456777e-16 + i   6.550587e-14       1.387779e-17 + i  -5.483665e-14\n[ 3,  1]      0.2085158 + i  -7.099942e-14         -0.2446311 + i   2.816924e-14\n[ 3,  2]   1.631182e-16 + i     5.0914e-14      -2.602085e-18 + i   -5.98862e-14\n[ 3,  3]   1.293236e-15 + i   4.262221e-15       6.938894e-18 + i  -3.148186e-14\n\natom 1:    2   atom 2:    2\n\n[ 0,  0]     -0.6134564 + i    1.38593e-23            0.88398 + i   8.116291e-27\n[ 0,  1]   8.050347e-10 + i   2.693026e-15      -3.214975e-12 + i  -5.239259e-16\n[ 0,  2]   -0.001454626 + i  -1.101068e-13      -1.481505e-14 + i    9.24825e-14\n[ 0,  3]    0.000841652 + i  -1.906746e-13        2.27099e-13 + i   1.601539e-13\n[ 1,  0]   8.050347e-10 + i  -2.693026e-15      -3.214975e-12 + i   5.239259e-16\n[ 1,  1]     -0.2476471 + i   1.505347e-25          0.9301216 + i  -3.952643e-27\n[ 1,  2]   1.600704e-13 + i  -3.216724e-17      -4.394056e-21 + i   1.456674e-26\n[ 1,  3]  -5.519154e-13 + i   1.846604e-17      -2.652918e-21 + i   2.522232e-26\n[ 2,  0]   -0.001454626 + i   1.101068e-13      -1.481505e-14 + i   -9.24825e-14\n[ 2,  1]   1.600704e-13 + i   3.216724e-17      -4.394056e-21 + i  -1.456674e-26\n[ 2,  2]     -0.6737121 + i   1.665185e-24           1.437192 + i    5.51595e-27\n[ 2,  3]      0.3774664 + i  -5.333161e-15          -0.440598 + i   -2.14174e-26\n[ 3,  0]    0.000841652 + i   1.906746e-13        2.27099e-13 + i  -1.601539e-13\n[ 3,  1]  -5.519154e-13 + i  -1.846604e-17      -2.652918e-21 + i  -2.522232e-26\n[ 3,  2]      0.3774664 + i   5.333161e-15          -0.440598 + i    2.14174e-26\n[ 3,  3]     -0.2378869 + i  -3.523334e-24          0.9284792 + i   5.138868e-26\n\nEigenvalues (Ry) and occupancies\n================================\n\nState:    1\n-----------\n\n   1)      -1.115311              1\n   2)     -0.7615419              1\n   3)     -0.6088921              1\n   4)      0.1193537              0\n   5)      0.1193713              0\n   6)      0.2675648              0\n   7)      0.2676033              0\n   8)      0.2859278              0\n\nState:    2\n-----------\n\n   1)     -0.7048227              1\n   2)     -0.7048226              1\n   3)     -0.5617645              1\n   4)     -0.5617645              1\n   5)    -0.02959216      0.5000012\n   6)    -0.02959215      0.4999988\n   7)    0.004706874   1.270932e-15\n   8)    0.004706891    1.27091e-15\n\nElectron chemical potential (Ry)\n================================\nMu =    -0.02959215\n\nEnergy\n======\nBreakdown of zeroth order energy:\nKinetic energy           =       6.363778 Ry\nNeutral atom energy      =      -8.262859 Ry\nElectrostatic energy     =       -11.9404 Ry\nNon-local energy         =       3.353513 Ry\nExchange and correlation =      -4.546535 Ry\n--------------------------------------------\nZeroth order energy      =       -15.0325 Ry\n\nBreakdown of first order energy:\nKinetic energy           =     -0.9859319 Ry\nNeutral atom energy      =      0.6195038 Ry\nElectrostatic energy     =              0 Ry\nNon-local energy         =     -0.3437992 Ry\nExchange and correlation =      0.1226381 Ry\n--------------------------------------------\nFirst order energy       =     -0.5875892 Ry\n\nBreakdown of total energy:\nKinetic energy           =       5.377847 Ry\nNeutral atom energy      =      -7.643355 Ry\nElectrostatic energy     =       -11.9404 Ry\nNon-local energy         =       3.009714 Ry\nExchange and correlation =      -4.423897 Ry\n--------------------------------------------\nTotal energy             =      -15.62009 Ry\n\nContribution from each order to the total energy:\nZeroth order energy      =       -15.0325 Ry\nFirst order energy       =     -0.5875892 Ry\nElectron entropy         =    0.001386294 Ry\nSecond order energy      =              0 Ry\n--------------------------------------------\nTotal energy             =      -15.62147 Ry\n\nCalculation of cohesive energy:\nTotal energy             =      -15.62147 Ry\nAtom energy              =      -14.46929 Ry\n--------------------------------------------\nCohesive energy          =      -1.152189 Ry\n\nCharge Multipoles\n=================\n             s  \n[   0]   0.00000\n[   1]  -0.00000\n\nTime distribution (s):\n======================\nTotal                      80.93\nBuild Hamiltonian          79.84\nDiagonalisation             0.00\nBuild density matrix        0.00\nNumerical integrals        80.07\nGaussian integrals          0.18\n")
	return outPath

def createSiBccDft2WithoutMatrixA():
	outPath = "testBccFileANoMatrices.out"
	with open(outPath,"wt") as f:
		f.write("    -----------------------------\n    | Density Functional Theory |\n    -----------------------------\n\n\nModel characteristics\n---------------------\nTabulated tight binding\nOverlap                 : 1\nCrystal field           : 1\nCrystal field correction: 0\nThree centre            : 0\n\nCell vectors in Bohr radii\n==========================\na1 = (         6.092,              0,              0)\na2 = (     -2.030666,       5.743592,              0)\na3 = (     -2.030666,      -2.871796,       4.974097)\n\nb1 = (      1.031383,       0.364649,      0.6315905)\nb2 = (            -0,       1.093947,      0.6315906)\nb3 = (             0,             -0,       1.263181)\n\nGeometry (xyz format in Angstroms)\n==================================\n1\n\nSi              0              0              0\n\nExchange and correlation functional\n===================================\nPBE\nExact functional\n\nIntegral mesh\n=============\nType                   : atom centered spherical mesh\nNumber of r points     : 60\nNumber of theta points : 50\nNumber of phi points   : 50\n\nEigenvalues (Ry) and occupancies\n================================\n\nState:    1\n-----------\n\n   1)      -1.013016              1\n   2)      0.1682637      0.3343842\n   3)      0.1682651      0.3340892\n   4)      0.1682766      0.3315266\n\nElectron chemical potential (Ry)\n================================\nMu =      0.1675753\n\nEnergy\n======\nBreakdown of zeroth order energy:\nKinetic energy           =       3.181889 Ry\nNeutral atom energy      =      -4.003146 Ry\nElectrostatic energy     =      -6.052649 Ry\nNon-local energy         =       1.674833 Ry\nExchange and correlation =      -2.186124 Ry\n--------------------------------------------\nZeroth order energy      =      -7.385197 Ry\n\nBreakdown of first order energy:\nKinetic energy           =      0.5604455 Ry\nNeutral atom energy      =     -0.3077279 Ry\nElectrostatic energy     =              0 Ry\nNon-local energy         =      0.1051214 Ry\nExchange and correlation =    -0.05450066 Ry\n--------------------------------------------\nFirst order energy       =      0.3033384 Ry\n\nBreakdown of total energy:\nKinetic energy           =       3.742335 Ry\nNeutral atom energy      =      -4.310874 Ry\nElectrostatic energy     =      -6.052649 Ry\nNon-local energy         =       1.779955 Ry\nExchange and correlation =      -2.240625 Ry\n--------------------------------------------\nTotal energy             =      -7.081859 Ry\n\nContribution from each order to the total energy:\nZeroth order energy      =      -7.385197 Ry\nFirst order energy       =      0.3033384 Ry\nElectron entropy         =    0.003819063 Ry\nSecond order energy      =              0 Ry\n--------------------------------------------\nTotal energy             =      -7.085678 Ry\n\nCalculation of cohesive energy:\nTotal energy             =      -7.085678 Ry\nAtom energy              =      -7.234643 Ry\n--------------------------------------------\nCohesive energy          =      0.1489651 Ry\n\nCharge Multipoles\n=================\n             s  \n[   0]  -0.00000\n\nTime distribution (s):\n======================\nTotal                      18.51\nBuild Hamiltonian          18.08\nDiagonalisation             0.00\nBuild density matrix        0.00\nNumerical integrals        18.09\nGaussian integrals          0.09\n\n")
	return outPath



def createSiBccGammaPointDft2OutFileA():
	outPath = "testBccFileA.out"
	with open(outPath,"wt") as f:
		f.write("    -----------------------------\n    | Density Functional Theory |\n    -----------------------------\n\n\nModel characteristics\n---------------------\nTabulated tight binding\nOverlap                 : 1\nCrystal field           : 1\nCrystal field correction: 0\nThree centre            : 0\nGaussian expansions\n===================\nAtom: Si\n--------\nOrbitals\n# l =  0 ng =   5\n#               a                           c\n     0.32043626491847215787       8.5356114316553099997\n     0.38797113579531211647      -24.895981596431024485\n     0.46998578963933906882       26.930256567032994752\n     0.57073673549305314889      -11.093819619116793262\n     0.73256953769067001403      0.52592505367091202384\n# l =  1 ng =   5\n#               a                           c\n     0.31987789145788841916       5.6359855523392603516\n     0.38388650455871509148      -14.820816124992456153\n     0.46704092355763748845       13.714861173542418626\n     0.60792740433717662452      -5.1567435543407542653\n     0.74674281141793452665       0.7814013948849088953\n\nDensity\n# ng =  10 np =   1\n#               a                           c\n     0.33312962173152449452       2.2806863321691452917\n     0.40203906396780392241      -10.173492052631981863\n     0.48337204068840278204       20.040608194931582631\n     0.58603889316855128921        -19.5730360969880266\n     0.81790391037392473628       19.304846186109678285\n      1.0192016450425376295      -19.810251699259815439\n      1.3298970981482607367       12.777696752831733562\n      1.7367203322291819845      -7.5858843831037727767\n      2.1634013670897007664       3.0756073390439451209\n      2.8921250919795071788     -0.33680747969040991663\n\nNeutral atom potential\n# ng =  10 np =   1\n#               a                           c\n     0.32120810150732020949      -10.634079724334942085\n     0.38901882733097142841       52.110190303751927843\n     0.49583076272399262407      -226.89366325210832542\n     0.60360661407919724564       534.38188413330226467\n     0.75072913530670093429      -882.78134380649680679\n     0.93346203151021545086       1187.7002960180916489\n       1.120768003823935377      -1031.7543430689008801\n      1.3938656778816160831       536.04048635685296631\n      1.6808076751381300085      -179.08517083643667434\n      3.4532372804028792501      -2.1911642048283463957\n\nNon-local pseudopotential\n# l =  0 ng =   1 np =   2\n#               a                           c\n      2.6346735529478948479      -1.2241902661681349773      -8.0897926897950593883\n# l =  0 ng =   1 np =   2\n#               a                           c\n      2.6346735320909129285      -6.1149204739210514248       6.8514853811027336405\n# l =  1 ng =   1 np =   1\n#               a                           c\n      2.0165647487931699366       7.5533132405112128893\n\nCell vectors in Bohr radii\n==========================\na1 = (         6.092,              0,              0)\na2 = (     -2.030666,       5.743592,              0)\na3 = (     -2.030666,      -2.871796,       4.974097)\n\nb1 = (      1.031383,       0.364649,      0.6315905)\nb2 = (            -0,       1.093947,      0.6315906)\nb3 = (             0,             -0,       1.263181)\n\nGeometry (xyz format in Angstroms)\n==================================\n1\n\nSi              0              0              0\n\nExchange and correlation functional\n===================================\nPBE\nExact functional\n\nIntegral mesh\n=============\nType                   : atom centered spherical mesh\nNumber of r points     : 60\nNumber of theta points : 50\nNumber of phi points   : 50\n\nHamiltonian (Ry) and overlap\n============================\n\nState:    1\n-----------\n\natom 1:    1   atom 2:    1\n\n[ 0,  0]      -1.427551 + i              0           1.409208 + i              0\n[ 0,  1]   1.317416e-15 + i              0       6.331942e-18 + i              0\n[ 0,  2]   1.165453e-12 + i              0      -1.077082e-17 + i              0\n[ 0,  3]  -1.776803e-13 + i              0      -1.714919e-17 + i              0\n[ 1,  0]   1.317416e-15 + i             -0       6.331942e-18 + i             -0\n[ 1,  1]     0.09454186 + i              0          0.5618671 + i              0\n[ 1,  2]  -1.673725e-09 + i              0       7.110292e-09 + i              0\n[ 1,  3]  -1.650689e-09 + i              0        6.87028e-09 + i              0\n[ 2,  0]   1.165453e-12 + i             -0      -1.077082e-17 + i             -0\n[ 2,  1]  -1.673725e-09 + i             -0       7.110292e-09 + i             -0\n[ 2,  2]      0.0945445 + i              0          0.5618671 + i              0\n[ 2,  3]  -2.949537e-06 + i              0       3.637756e-09 + i              0\n[ 3,  0]  -1.776803e-13 + i             -0      -1.714919e-17 + i             -0\n[ 3,  1]  -1.650689e-09 + i             -0        6.87028e-09 + i             -0\n[ 3,  2]  -2.949537e-06 + i             -0       3.637756e-09 + i             -0\n[ 3,  3]     0.09454719 + i              0          0.5618671 + i              0\n\nEigenvalues (Ry) and occupancies\n================================\n\nState:    1\n-----------\n\n   1)      -1.013016              1\n   2)      0.1682637      0.3343842\n   3)      0.1682651      0.3340892\n   4)      0.1682766      0.3315266\n\nElectron chemical potential (Ry)\n================================\nMu =      0.1675753\n\nEnergy\n======\nBreakdown of zeroth order energy:\nKinetic energy           =       3.181889 Ry\nNeutral atom energy      =      -4.003146 Ry\nElectrostatic energy     =      -6.052649 Ry\nNon-local energy         =       1.674833 Ry\nExchange and correlation =      -2.186124 Ry\n--------------------------------------------\nZeroth order energy      =      -7.385197 Ry\n\nBreakdown of first order energy:\nKinetic energy           =      0.5604455 Ry\nNeutral atom energy      =     -0.3077279 Ry\nElectrostatic energy     =              0 Ry\nNon-local energy         =      0.1051214 Ry\nExchange and correlation =    -0.05450066 Ry\n--------------------------------------------\nFirst order energy       =      0.3033384 Ry\n\nBreakdown of total energy:\nKinetic energy           =       3.742335 Ry\nNeutral atom energy      =      -4.310874 Ry\nElectrostatic energy     =      -6.052649 Ry\nNon-local energy         =       1.779955 Ry\nExchange and correlation =      -2.240625 Ry\n--------------------------------------------\nTotal energy             =      -7.081859 Ry\n\nContribution from each order to the total energy:\nZeroth order energy      =      -7.385197 Ry\nFirst order energy       =      0.3033384 Ry\nElectron entropy         =    0.003819063 Ry\nSecond order energy      =              0 Ry\n--------------------------------------------\nTotal energy             =      -7.085678 Ry\n\nCalculation of cohesive energy:\nTotal energy             =      -7.085678 Ry\nAtom energy              =      -7.234643 Ry\n--------------------------------------------\nCohesive energy          =      0.1489651 Ry\n\nCharge Multipoles\n=================\n             s  \n[   0]  -0.00000\n\nTime distribution (s):\n======================\nTotal                      18.51\nBuild Hamiltonian          18.08\nDiagonalisation             0.00\nBuild density matrix        0.00\nNumerical integrals        18.09\nGaussian integrals          0.09\n")
	return outPath



if __name__ == '__main__':
	unittest.main()

